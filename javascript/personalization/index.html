<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Optimizely Developers</title>
    <meta charset="UTF-8">
    <meta name="description" content="Optimizely Developer Documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>

    <!-- This should be the first script to make sure redirects work quickly. -->
    <script src="/assets/js/bundle.js" type="text/javascript"></script>

    <!-- Demandbase -->
    <script>
      (function(d,b,a,s,e) {
        var t = b.createElement(a), fs = b.getElementsByTagName(a)[0];
        t.async=1; t.id=e; t.src=('https:'==document.location.protocol ? 'https://' : 'http://') + s;
        fs.parentNode.insertBefore(t, fs);
      })(window,document,'script','scripts.demandbase.com/q8GATaKQ.min.js','demandbase_js_lib');
    </script>

    <!-- Heap Analytics -->
    <script type="text/javascript">
      if (document.location.hostname != "localhost") {
        window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("411455962");
      }
    </script>

    <!-- Optimizely -->
    <script src="//cdn.optimizely.com/js/6663270427.js"></script>
  </head>
  <body class="javascript personalization">
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <!-- <symbol id="add" viewBox="-590 386 16 16">
      <path d="M-575 395v-2h-6v-6h-2v6h-6v2h6v6h2v-6z"/>
    </symbol>
    <symbol id="align-center" viewBox="0 0 32 32">
      <g><path d="M28 6H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM24 14H8c-1.1 0-2-.9-2-2s.9-2 2-2h16c1.1 0 2 .9 2 2s-.9 2-2 2zM28 22H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM24 30H8c-1.1 0-2-.9-2-2s.9-2 2-2h16c1.1 0 2 .9 2 2s-.9 2-2 2z"/></g>
    </symbol>
    <symbol id="align-justify" viewBox="0 0 32 32">
      <g><path d="M28 6H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 14H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 22H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 30H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2z"/></g>
    </symbol>
    <symbol id="align-left" viewBox="0 0 32 32">
      <g><path d="M28 6H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM18 14H4c-1.1 0-2-.9-2-2s.9-2 2-2h14c1.1 0 2 .9 2 2s-.9 2-2 2zM28 22H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM18 30H4c-1.1 0-2-.9-2-2s.9-2 2-2h14c1.1 0 2 .9 2 2s-.9 2-2 2z"/></g>
    </symbol>
    <symbol id="align-right" viewBox="0 0 32 32">
      <g><path d="M28 6H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 14H14c-1.1 0-2-.9-2-2s.9-2 2-2h14c1.1 0 2 .9 2 2s-.9 2-2 2zM28 22H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 30H14c-1.1 0-2-.9-2-2s.9-2 2-2h14c1.1 0 2 .9 2 2s-.9 2-2 2z"/></g>
    </symbol>
    <symbol id="archive" viewBox="0 0 32 32">
      <g><path d="M30 4c0-1.3-.6-2-2-2H4c-1.3 0-2 .6-2 2v4h28V4zM4 10v18c0 1.3.6 2 2 2h20c1.3 0 2.1-.6 2.1-2V10H4z"/><path fill="#fff" d="M18 18v-8h-4v8H8l8 8 8-8z"/></g>
    </symbol>
    <symbol id="arrow-left" viewBox="-463 265 32 32">
      <path d="M-454.8 281l11.3 11.3 4.3-4.2-7.1-7.1 7.1-7.1-4.3-4.2z"/>
    </symbol>
    <symbol id="arrow-right" viewBox="-463 265 32 32">
      <path d="M-439.2 281l-11.3-11.3-4.3 4.2 7.1 7.1-7.1 7.1 4.3 4.2z"/>
    </symbol>
    <symbol id="audiences" viewBox="0 0 32 32">
      <g><path d="M11.5 11.4c0 1.9 1.2 3.6 2.8 4.3.6.2 1.2.4 1.8.4 2.6 0 4.7-2.1 4.7-4.7 0-1.9-1.2-3.6-2.8-4.3-.6-.2-1.2-.4-1.8-.4-2.6.1-4.7 2.1-4.7 4.7zM22.8 11.1c.4.1.7.1 1.1.1 2.6 0 4.7-2.1 4.7-4.7s-2.1-4.7-4.7-4.7c-2.2 0-4.1 1.6-4.5 3.6 2 1.3 3.3 3.3 3.4 5.7zM14.2 16C10.9 16 8 20.4 8 23.7V28.6l.3.1c3.1 1 3.8 1.2 7.6 1.2 4.4 0 7.6-1.5 7.7-1.6l.4-.3v-4.4c0-2.9-1.9-6.4-4.6-7.2-.4-.1-.8-.4-1.2-.4h-4zM8 11.3c.5 0 1-.1 1.5-.3.1-2.2 1.3-4.1 3.1-5.2-.4-2.2-2.3-3.9-4.6-3.9-2.6 0-4.6 2.1-4.6 4.7s2 4.7 4.6 4.7zM6 23.7c0-3.1 2-6.5 4.8-8.1C10 14.5 9.6 13 9.5 12H6c-3.3 0-6 2.3-6 5.6v6.3l.3.1c2.1.7 3.6 1 5.6 1.2v-1.5zM25.9 12h-3.1c0 1-.5 2.5-1.3 3.6.9.5 1.7 1.1 2.4 2.1 1.3 1.7 2.1 3.8 2.1 5.9V25c3.4-.2 5.4-.9 5.6-1h.4v-6.4c0-3.3-2.8-5.6-6.1-5.6z"/></g>
    </symbol>
    <symbol id="calendar" viewBox="0 0 32 32">
      <path d="M22 2V0h-4v2h-6V0H8v2H0v30h30V2h-8zM10 28H4v-6h6v6zm0-8H4v-6h6v6zm8 8h-6v-6h6v6zm0-8h-6v-6h6v6zm0-8H4V6h14v6zm8 16h-6v-6h6v6zm0-8h-6v-6h6v6zm0-8h-6V6h6v6z"/>
    </symbol>
    <symbol id="check" viewBox="-595 381 32 32">
      <path d="M-564.2 389l-4.3-4.3-15.2 15.2-6.1-6.1-4.2 4.3 10.3 10.3"/>
    </symbol> -->
    <symbol id="clipboard" viewBox="0 0 32 32">
      <g><path d="M10 12h12v4H10zM10 20h12v4H10zM18 2V0h-4v2H2v30h28V2H18zm8 26H6V6h4v2h12V6h4v22z"/></g>
    </symbol>
    <!-- <symbol id="close" viewBox="-289 381 32 32">
      <path d="M-261.7 389.8l-4.2-4.2-7.1 7.1-7.1-7.1-4.2 4.2 7.1 7.1-7.1 7.1 4.2 4.2 7.1-7.1 7.1 7.1 4.2-4.2-7.1-7.1z"/>
    </symbol>
    <symbol id="code" viewBox="0 0 32 32">
      <g><path d="M8 25.4c-.4 0-.8-.2-1.1-.5L.3 17c-.4-.5-.4-1.3 0-1.8l6.2-7.9c.5-.7 1.5-.9 2.1-.4.6.5.7 1.4.3 2L3.3 16l5.8 7c.5.6.4 1.5-.2 2-.3.2-.6.4-.9.4zM24 25.4c-.3 0-.7-.1-.9-.3-.6-.5-.7-1.4-.2-2l5.7-7.1-5.5-7c-.5-.6-.4-1.5.3-2 .6-.5 1.5-.4 2 .3l6.1 7.9c.4.5.4 1.3 0 1.8L25 24.9c-.2.3-.6.5-1 .5zM13.7 27.8c-.1 0-.2 0-.3-.1-.7-.2-1.2-.9-1.1-1.7l4.9-20.8c.2-.7 1-1.2 1.8-1 .7.2 1.2.9 1.1 1.7l-4.9 20.8c-.3.7-.9 1.1-1.5 1.1z"/></g>
    </symbol>
    <symbol id="collaborators" viewBox="0 0 32 32">
      <g><circle cx="9" cy="7" r="5"/><circle cx="23" cy="7" r="5"/><path d="M32 32v-.2L28 16c0-1.1-.9-2-2-2h-6c-1.1 0-2 .9-2 2v16h14zM13.9 32l.1-.2V15.9c0-1.1-1-1.9-2.1-1.9h-6c-1.1 0-1.9.8-1.9 1.9L0 31.8l-.1.2h14z"/></g>
    </symbol>
    <symbol id="dimensions" viewBox="0 0 32 32">
      <g><path fill="#fff" d="M17 2L2 8l14.9 6L32 7.9 17 2z"/><path d="M16 30L2 24V10l14 6zM30 12.6v9.8l-10 4.9v-9.8l10-4.9m2-2.7l-14 6v14l14-6v-14z"/><path fill="#fff" d="M30 12.6v9.8l-10 4.9v-9.8l10-4.9"/><path stroke="#000" stroke-width="2" stroke-miterlimit="10" d="M30 8M4 8" fill="none"/><path d="M17 4.1L27.2 8l-10.3 4L6.7 8 17 4.1M17 2L2 8l14.9 6L32 7.9 17 2z"/></g>
    </symbol>
    <symbol id="duplicate" viewBox="0 0 32 32">
      <g><path d="M22 32H2c-1.1 0-2-.9-2-2V9.9c0-1.1.9-2 2-2h20c1.1 0 2 .9 2 2V30c0 1.1-.9 2-2 2zM30 0H10C8.9 0 8 .9 8 2v2h18c1.1 0 2 .8 2 1.9V24h2c1.1 0 2-.8 2-1.9V2c0-1.1-.9-2-2-2z"/><path fill="#fff" d="M18 18h-4v-4h-4v4H6v4h4v4h4v-4h4z"/></g>
    </symbol>
    <symbol id="editor-switch" viewBox="0 0 16 16">
      <path fill="#fff" d="M10.2 7.4v-2c0-1.7-1.4-3-3-3h-.6c-1.6 0-3 1.3-3 3v2c0 1.7 1.4 3 3 3h.6c1.6 0 3-1.3 3-3z"/><path d="M9.9 10.9h-6c-.5 0-.9-.4-.9-.9V2.8c0-.5.4-.9.9-.9h6c.5 0 .9.4.9.9v7.3c-.1.5-.5.8-.9.8zm-5.8-1h5.5V3H4.1v6.9z"/><path fill="#fff" d="M12.3 10.5v-2c0-1.7-1.3-3-3-3h-.6c-1.6 0-3 1.4-3 3v2c0 1.6 1.3 3 3 3h.6c1.6 0 3-1.3 3-3z"/><path d="M12 14.1H6c-.5 0-.9-.4-.9-.9V5.9c0-.5.4-.9.9-.9h6c.5 0 .9.4.9.9v7.3c-.1.5-.5.9-.9.9zM6.2 13h5.5V6.1H6.2V13zM15.2 6.6l-1-.3c.2-.7 0-1.3-.4-1.8-.5-.5-1.3-.6-2-.3l-.4-1c1.1-.5 2.3-.3 3.1.4.7.8 1 1.9.7 3zM13.7 5.3L13.6 8 16 6.8zM3.2 13c-.8 0-1.6-.3-2.2-1-1.1-1.2-1.3-3-.6-4.5l1 .5c-.6 1.1-.4 2.4.4 3.3.6.6 1.4.8 2.3.4l.4 1c-.5.2-.9.3-1.3.3zM1.8 8.9l.3-2.7-2.5 1z"/>
    </symbol>
    <symbol id="experiments" viewBox="0 0 32 32">
      <g><path d="M0 22v10h32V14l-10 6-12-4zM22 12.1l-12-4-10 6v-4L10 4l12 4 10-6.4V6z"/></g>
    </symbol>
    <symbol id="external" viewBox="-752 644.1 31 30.9">
      <g><path d="M-726 644.9c0-.2-.1-.4-.2-.6-.2-.2-.3-.2-.6-.2l-7.6.1c-.3 0-.6.2-.7.5-.1.2-.1.6.1.8l7.6 7.7c.2.2.5.2.8.1.3-.2.5-.4.5-.7l.1-7.7M-740.8 656.8l2.2 2.2 11.1-11.1-2.2-2.2-11.1 11.1"/><path d="M-731.2 658.1v8.8h-17.6v-17.6h8.8v-3.2h-12v24h24v-12z"/></g>
    </symbol>
    <symbol id="goal" viewBox="0 0 32 32">
      <g><path d="M2 .1C3 .1 4 1 4 2v30H0V2C0 1 .9.1 2 .1zM25 6.2c2.4 0 5.5-1.3 6.9-2.3v18.6c-1.4 1-4.6 2.3-6.9 2.3s-4.5-.7-5.9-1.7c-1.4-1-2.8-1.7-5.1-1.7-2.4 0-4.5 1.5-6 2.5V5.3c1.4-1 3.6-2.5 6-2.5s3.7.7 5.1 1.7 3.5 1.7 5.9 1.7z"/></g>
    </symbol>-->
    <symbol id="hamburger" viewBox="0 0 32 32">
      <path d="M28 8H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 18H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2zM28 28H4c-1.1 0-2-.9-2-2s.9-2 2-2h24c1.1 0 2 .9 2 2s-.9 2-2 2z"/>
    </symbol>
    <!--<symbol id="history" viewBox="0 0 32 32">
      <g><path d="M18 2C10.9 2 5.1 7.2 4.2 14H0l6 6 6-6H7.2c.9-5.1 5.4-9 10.8-9 6.1 0 11 4.9 11 11s-4.9 11-11 11c-4 0-7.6-2.2-9.5-5.5l-2.2 2.2C8.8 27.5 13.1 30 18 30c7.7 0 14-6.3 14-14S25.7 2 18 2zM16 8h4v8h-4zM20.9 23.9L24 22l-4-6h-4z"/></g>
    </symbol>
    <symbol id="inconclusive" viewBox="0 0 32 32">
      <circle fill="#fff" cx="16" cy="15.9" r="15.9"/><path d="M16 3c7.1 0 12.9 5.8 12.9 12.9s-5.8 13-12.9 13-13-5.8-13-13S8.8 3 16 3m0-3C7.2 0 0 7.1 0 15.9s7.2 16 16 16S31.9 24.8 31.9 16 24.8 0 16 0zM14 6h4v12h-4zM14 14h10v4H14z"/>
    </symbol>
    <symbol id="integrations" viewBox="0 0 32 32">
      <g><path d="M25.5 9.3c.1.4.2.8.2 1.2.1.8 0 1.8-.1 2.5 2.1 1.7 3.4 4.2 3.4 7 0 5-4 9-9 9s-9-4-9-9c0-4.6 3.4-8.3 7.8-8.9 0-.4-.1-1.1-.4-1.9-.2-.4-.3-.8-.5-1C12.3 9.2 8 14.1 8 20c0 6.6 5.4 12 12 12s12-5.4 12-12c0-4.6-2.6-8.7-6.5-10.7zM12 0C5.4 0 0 5.4 0 12c0 4.4 2.4 8.3 6 10.4-.1-.8-.2-1.6-.2-2 0-.4.1-1.2.2-1.7C4.1 17 3 14.6 3 12c0-5 4-9 9-9s9 4 9 9c0 4.5-3.3 8.3-7.7 8.9 0 .5 0 .9.3 1.5.3.7.4 1 .7 1.3 5.5-1.1 9.6-6 9.6-11.8C24 5.4 18.6 0 12 0z"/></g>
    </symbol>
    <symbol id="live-variables" viewBox="0 0 32 32">
      <g><path d="M30 0h-6c-1.1 0-2 .9-2 2s.9 2 2 2h4v24h-4c-1.1 0-2 .9-2 2s.9 2 2 2h6c1.1 0 2-.9 2-2V2c0-1.1-.9-2-2-2zM2 32h6c1.1 0 2-.9 2-2s-.9-2-2-2H4V4h4c1.1 0 2-.9 2-2s-.9-2-2-2H2C.9 0 0 .9 0 2v28c0 1.1.9 2 2 2zM22.2 20.7c-.2 0-.6.1-.7.1-1.1 0-3.1-.5-3.9-3.9l5.8-5.9s1.2-1.2.4-2.3c-.3-.6-1.8-1-2.6-.2l-4.3 4.3C15 8.4 11.1 8 9.7 8S8 9.8 8 10.8c0 1 .9 2.1 2.2 2.2s3.2-.2 4.1 3.2l-5.6 5.3c-.3.3-.5.6-.5 1.1 0 .5.2.8.5 1.1.3.4.8.3 1.3.3s.9 0 1.4-.4l3.8-4.1c1.9 4.2 5.3 4.5 6.7 4.5 0 0 2.1-.1 2.1-2 0-1.2-1-1.3-1.8-1.3z"/></g>
    </symbol>
    <symbol id="lock" viewBox="0 0 32 32">
      <g><path d="M26 12c0-5.5-4.5-10-10-10S6 6.5 6 12c-1.2 0-2 .9-2 2v16c0 1.1.8 2 1.9 2h20c1.1 0 2-.9 2-2V14c.1-1.1-.8-2-1.9-2zm-4.1 0h-13c0-3.9 3.1-7 7-7s7 3.1 7 7h-1z"/><path fill="#fff" d="M20 20c0-2.2-1.8-4-4-4s-4 1.8-4 4c0 1.5.8 2.8 2 3.4V26c0 1.1.9 2 2 2s2-.9 2-2v-2.6c1-.7 2-1.9 2-3.4z"/></g>
    </symbol>
    <symbol id="loser" viewBox="0 0 32 32">
      <circle cx="16" cy="16" r="16"/><path fill="#fff" d="M14 6h4v14h-4zM14 22h4v4h-4z"/>
    </symbol>
    <symbol id="paperclip" viewBox="0 0 32 32">
      <path d="M15.6 32c-4.1 0-8.2-2.4-8.2-7V6.8c0-4.5 2.9-6.8 5.8-6.8S19 2.4 19 6.8v15.8c0 2.6-1.7 3.9-3.4 3.9-.9 0-1.8-.4-2.4-1-.5-.5-1-1.4-1-2.9V8c0-.6.4-1 1-1s1 .4 1 1v14.6c0 1.3.7 1.9 1.4 1.9s1.4-.6 1.4-1.9V6.8C17 3.5 15 2 13.2 2S9.3 3.5 9.3 6.8V25c0 3.4 3.2 5 6.2 5s6.2-1.6 6.2-5V8c0-.6.4-1 1-1s1 .4 1 1v17c.1 4.6-4 7-8.1 7z"/>
    </symbol>
    <symbol id="pause" viewBox="0 0 32 32">
      <g><path d="M6 4h8v24H6zM18 4h8v24h-8z"/></g>
    </symbol>
    <symbol id="play" viewBox="0 0 32 32">
      <path d="M4 4v24l23.9-12z"/>
    </symbol>
    <symbol id="projects" viewBox="0 0 32 32">
      <g><path d="M2 4h4v4H2zM10 4h20v4H10zM2 14h4v4H2zM10 14h20v4H10zM2 24h4v4H2zM10 24h20v4H10z"/></g>
    </symbol>
    <symbol id="redo" viewBox="-471 274 16 14">
      <g><path d="M-455.7 279l-3.7 3.6c-.2.2-.4.2-.6.1-.2-.1-.3-.2-.3-.4v-7.4c0-.2.1-.4.3-.4.2-.1.4 0 .6.1l3.7 3.6c.1.1.2.2.2.4-.1.1-.1.2-.2.4"/><path d="M-465.9 277.8h8.9v1.6h-8.9c-1.7 0-3 1.3-3 3v.4c0 1.6 1.4 3 3 3h1.8c.4 0 .8.3.8.8 0 .4-.4.8-.8.8h-1.8c-2.6 0-4.6-2-4.6-4.5v-.4c-.1-2.7 2-4.7 4.6-4.7"/></g>
    </symbol>
    <symbol id="refresh" viewBox="0 0 32 32">
      <path d="M24.6 9.5l-2.2 2.2c.7 1.2 1.1 2.5 1.1 3.9 0 4.3-3.5 7.8-7.8 7.8s-7.8-3.5-7.8-7.8 3.5-7.8 7.8-7.8h.3V13l4.7-4.7 1.6-1.6L16 .5v4.4h-.3C9.8 4.9 5 9.7 5 15.6c0 5.9 4.8 10.8 10.8 10.8 5.9 0 10.8-4.8 10.8-10.8-.1-2.2-.8-4.4-2-6.1z"/>
    </symbol>
    <symbol id="save" viewBox="-472 273 15 16">
      <g><path d="M-458.9 273.9v6H-470v-6h-1.7v13.4c0 .5.4.9.9.9h12.6c.5 0 .9-.4.9-.9v-11.8l-1.6-1.6"/><path d="M-463 273.9h2.4v4.8h-2.4v-4.8z"/></g>
    </symbol>-->
    <symbol id="search-16" viewBox="0 0 16 16">
       <g><g><path d="M6.21,12.417C2.786,12.417,0,9.632,0,6.209C0,2.785,2.786,0,6.21,0c3.422,0,6.206,2.785,6.206,6.209
			C12.416,9.632,9.632,12.417,6.21,12.417z M6.21,1C3.337,1,1,3.337,1,6.209s2.337,5.208,5.21,5.208c2.87,0,5.206-2.336,5.206-5.208
			S9.08,1,6.21,1z"/> <path d="M15.5,16c-0.128,0-0.256-0.049-0.354-0.146l-5.25-5.25c-0.195-0.195-0.195-0.512,0-0.707s0.512-0.195,0.707,0l5.25,5.25
			c0.195,0.195,0.195,0.512,0,0.707C15.756,15.951,15.628,16,15.5,16z"/></g></g>
    </symbol>
    <!--
    <symbol id="settings" viewBox="0 0 32 32">
      <path d="M30.8 13.5l-3.1-.5c-.2-.9-.6-1.8-1-2.6l2-2.5c.4-.5.4-1.3 0-1.8l-1.2-1.4c-.5-.6-1.3-.7-1.8-.3L23 6.1c-1.2-.8-2.5-1.4-4-1.8l-.5-3.1C18.4.5 17.8 0 17.2 0h-1.9c-.7 0-1.3.5-1.4 1.2l-.5 3.1c-1.2.3-2.3.8-3.3 1.4L7.5 3.9c-.5-.4-1.3-.4-1.8.1L4.4 5.3c-.5.5-.5 1.3-.1 1.8l1.8 2.6c-.6 1-1.1 2.1-1.4 3.3l-3.2.5c-.7.1-1.2.7-1.2 1.4v1.9c0 .7.5 1.3 1.2 1.4l3.2.5c.2 1 .6 1.9 1 2.8l-2 2.5c-.4.5-.4 1.3 0 1.8l1.2 1.4c.5.5 1.2.6 1.8.3l2.7-1.7c1.1.8 2.4 1.4 3.8 1.7l.5 3.1c.1.7.7 1.2 1.4 1.2H17c.7 0 1.3-.5 1.4-1.2l.5-3.1c1.2-.3 2.3-.7 3.3-1.4l2.7 1.9c.5.4 1.3.3 1.8-.1l1.3-1.3c.5-.5.5-1.2.1-1.8l-1.9-2.6c.6-1 1.1-2.1 1.4-3.3l3.1-.5c.7-.1 1.2-.7 1.2-1.4v-1.9c.1-.9-.4-1.5-1.1-1.6zm-14.6 8.2c-3.3 0-5.9-2.7-5.9-5.9 0-3.3 2.7-5.9 5.9-5.9 3.3 0 5.9 2.7 5.9 5.9.1 3.3-2.6 5.9-5.9 5.9z"/>
    </symbol>
    <symbol id="star" viewBox="0 0 32 32">
      <path d="M16 2l3.7 10.7h11.1l-8.9 6.7L25.2 30 16 23.7 6.9 30l3.2-10.6-8.8-6.7h11.1z"/>
    </symbol>
    <symbol id="sync" viewBox="0 0 32 32">
      <g><path d="M24.6 9.5l-1.9 1.9c1.9 3.1 1.4 7.3-1.3 10-2 2-4.4 2.7-7.4 2.2v-5l-4.6 4.7-1.6 1.6 6.2 6.3v-4.8c3 .5 6.8-.5 9.3-3 3.7-3.9 4.2-9.8 1.3-13.9zM10.1 9.9C11.7 8.3 14 7.5 16 7.6v5.5l4.7-4.7 1.6-1.6L16 .5v4.4c-3 0-5.6 1-7.8 3.1-3.6 3.6-4.1 9-1.6 13.1l2-2c-1.5-2.9-1-6.7 1.5-9.2z"/></g>
    </symbol>
    <symbol id="trash" viewBox="0 0 32 32">
      <g><path d="M8-.1h14V2H8zM2 2h26v6H2zM4 10h22v22H4z"/></g>
    </symbol>
    <symbol id="undo" viewBox="-471 274 16 14">
      <g><path d="M-470.3 279l3.7 3.6c.2.2.4.2.6.1.2-.1.3-.2.3-.4v-7.4c0-.2-.1-.4-.3-.4-.2-.1-.4 0-.6.1l-3.7 3.6c-.1.1-.2.2-.2.4.1.1.1.2.2.4"/><path d="M-460.1 277.8h-8.9v1.6h8.9c1.7 0 3 1.3 3 3v.4c0 1.6-1.4 3-3 3h-1.8c-.4 0-.8.3-.8.8 0 .4.4.8.8.8h1.8c2.6 0 4.6-2 4.6-4.5v-.4c.1-2.7-2-4.7-4.6-4.7"/></g>
    </symbol>
    <symbol id="userlist" viewBox="0 0 32 32">
      <g><path d="M15.075 6.574c0 2.96-2.398 5.36-5.358 5.36-2.96 0-5.36-2.4-5.36-5.36 0-2.96 2.4-5.36 5.36-5.36 2.96 0 5.358 2.4 5.358 5.36"/><path d="M.57 26.43s-1.63-14.7 8.932-14.7c10.562 0 8.784 14.7 8.784 14.7s-3.22 1.186-8.846 1.186c-5.625 0-8.87-1.187-8.87-1.187"/><path d="M30.642 4.176H17.23c-.373 0-.675-.302-.675-.674v-1.7c0-.373.302-.675.675-.675h13.412c.373 0 .675.302.675.674v1.702c0 .372-.302.674-.675.674"/><path d="M30.642 18.303h-8.84c-.373 0-.675-.303-.675-.674v-1.703c0-.373.302-.674.674-.674h8.842c.373 0 .675.3.675.674v1.702c0 .37-.302.673-.675.673"/><path d="M30.642 11.446H19.515c-.372 0-.674-.303-.674-.675v-1.7c0-.373.303-.675.675-.675h11.127c.373 0 .675.302.675.675v1.7c0 .373-.302.676-.675.676"/><path d="M30.642 25.57h-6.555c-.373 0-.674-.3-.674-.673v-1.7c0-.373.3-.675.674-.675h6.555c.373 0 .675.302.675.675v1.7c0 .373-.302.674-.675.674"/></g>
    </symbol>
    <symbol id="variation-settings" viewBox="0 0 32 32">
      <g><path d="M12 12.6v-.7c-.5-2.1-2-3.8-4-4.5V0H4v7.3c-2.3.8-4 3-4 5.7s1.7 4.8 4 5.7V32h4V18.7c2-.7 3.5-2.5 3.9-4.6V13s.1-.3.1-.4zM6 16c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zM22 21.6v-.7c-.4-2.1-1.9-3.9-3.9-4.6V0h-4v16.3c-2.3.8-4 3-4 5.7s1.7 4.8 4 5.7V32h4v-4.3c2-.7 3.5-2.5 3.9-4.6v-1.5zM16 25c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zM32 9.6v-.7c-.5-2.1-2-3.8-4-4.5V0h-4v4.3c-2 .8-4 3-4 5.7s2 4.8 4 5.7V32h4V15.7c2-.7 3.5-2.5 3.9-4.6V10s.1-.3.1-.4zM26 13c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.4 3-3 3z"/></g>
    </symbol>
    <symbol id="winner" viewBox="0 0 32 32">
      <circle cx="16" cy="16" r="16"/><path fill="#fff" d="M16.9 21.5l7.8-12.4-3.6-2.3L13.2 19l-3.6-2.3-2.3 3.6 6.8 4.5.4.3.5-.6z"/>
    </symbol> -->
</svg>


  <header id="header" class="header justify background--super-dark">
    
    <div class="link--reverse hidden is-inline-block-on-mobile nav-toggle">
      <label for="toggle-nav-checkbox">
        <svg class="icon">
          <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#hamburger"></use>
        </svg>
      </label>
    </div>
    

    <a class="display--inline-block header-logo-container" href="/">
      <img src="/assets/img/optimizely-developer-logo.svg" alt="Optimizely Developers">
    </a>

    <div class="header-links display--inline-block vertical-align--top is-hidden-on-mobile">
      <div class="position--relative display--inline-block push-double--right">
        <input type="text" id="site-search" placeholder="Search" class="text-input text-input--small reverse soft-triple--right width--200">
        <svg class="icon input-icon__right reverse cursor--pointer">
          <use xlink:href="#search-16"></use>
        </svg>
      </div>

      <div class="display--inline-block">
        <ul class="unstyled nav">
          <li class="push-double--right"><a href="/overview">Overview</a></li>
          <li class="position--relative push-double--right">
            <a href="/rest/introduction" data-collapser>
              Documentation
              <span class="arrow-inline--down"></span>
            </a>
            <ul class="unstyled nav nav--stacked dropdown background--super-dark soft--sides collapsible--small is-collapsed" data-auto-close>
              
                
              
                
                  <li class="push-half">
                    <a href="/javascript/">Web</a>
                  </li>
                
              
                
                  <li class="push-half">
                    <a href="/ios/">iOS</a>
                  </li>
                
              
                
                  <li class="push-half">
                    <a href="/android/">Android</a>
                  </li>
                
              
                
              
                
                  <li class="push-half">
                    <a href="/rest/">REST API</a>
                  </li>
                
              
                
              
                
                  <li class="push-half">
                    <a href="/integrations/">Integrations</a>
                  </li>
                
              
                
                  <li class="push-half">
                    <a href="/apps/">Apps</a>
                  </li>
                
              
                
              
            </ul>
          </li>
          <li class="push-double--right"><a href="http://community.optimizely.com/t5/Developers/bd-p/Developers" target="_blank">Discussion</a></li>
          <li class="flush"><a href="https://devplatform.typeform.com/to/XrDLzQ">Feedback</a></li>
        </ul>
      </div>
    </div>
  </header>


  <main id="main" class="main has-nav">
    <input id="toggle-nav-checkbox" class="hidden" type="checkbox">
<nav id="nav">
  <div class="nav-sidebar">

    <div class="soft-double">
      
        
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/overview">Overview</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
          </ul>
        
      
        
          
            <label class="label caps micro muted">Solutions</label>
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section active" href="/javascript" data-collapser>Web</a>

                  <!-- TOC for single pages -->
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible">
                    
                      <li>
                        <a class="section" href="/javascript/introduction/index.html">Introduction</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/javascript/getting-started/index.html">Getting started</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/javascript/reference/index.html">Reference</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/javascript/code-samples/index.html">Code Samples</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section active" href="/javascript/personalization/index.html">Personalization</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/ios" data-collapser>iOS</a>

                  <!-- TOC for single pages -->
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    
                      <li>
                        <a class="section" href="/ios/introduction/index.html">Introduction</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/ios/getting-started/index.html">Getting started</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/ios/reference/index.html">Reference</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/ios/faqs/index.html">FAQs</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/ios/guide/index.html">Tutorial</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/ios/changelog/index.html">Changelog</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/ios/articles/index.html">Articles</a>
                        
                        
                      </li>
                    

                    <!-- Add links to auto generated docs -->
                    
                      <li>
                        <a class="section" href="/ios/help/html/index.html" target="_blank">Apple Docs <img class="display--inline-block" width="12" height="12" src="/assets/img/external-link.png"></a>
                      </li>
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/android" data-collapser>Android</a>

                  <!-- TOC for single pages -->
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    
                      <li>
                        <a class="section" href="/android/introduction/index.html">Introduction</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/android/getting-started/index.html">Getting started</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/android/reference/index.html">Reference</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/android/faqs/index.html">FAQs</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/android/guide/index.html">Tutorial</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/android/changelog/index.html">Changelog</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/android/articles/index.html">Articles</a>
                        
                        
                      </li>
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                      <li>
                        <a class="section" href="/android/help/index.html" target="_blank">Java Docs <img class="display--inline-block" width="12" height="12" src="/assets/img/external-link.png"></a>
                      </li>
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
            
          </ul>
        
      
        
          
            <label class="label caps micro muted">Management</label>
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/rest" data-collapser>REST API</a>

                  <!-- TOC for single pages -->
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    
                      <li>
                        <a class="section" href="/rest/introduction/index.html">Introduction</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/rest/getting-started/index.html">Getting started</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/rest/reference/index.html">Reference</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/rest/conditions/index.html">Audience Conditions</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
          </ul>
        
      
        
          
            <label class="label caps micro muted">Authentication</label>
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/oauth">OAuth 2.0</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/token">Token based</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
          </ul>
        
      
        
          
            <label class="label caps micro muted">Data Services</label>
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/events" data-collapser>Event Access</a>

                  <!-- TOC for single pages -->
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    
                      <li>
                        <a class="section" href="/events/introduction/index.html">Introduction</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/events/api/index.html">Event API</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    
                      <li>
                        <a class="section" href="/events/export/index.html">Data Export</a>
                        
                          <ul class="unstyled nav nav--stacked toc"></ul>
                        
                        
                      </li>
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/customer-profiles">Customer Profiles</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/results">Experiment Results</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
          </ul>
        
      
        
          
            <label class="label caps micro muted">Add Ons</label>
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/integrations">Integrations</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/apps">Apps</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/extensions">Extensions</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
          </ul>
        
      
        
          
            <label class="label caps micro muted">Community</label>
          
          <ul class="unstyled epsilon push--bottom soft-half--bottom">
            
              <!-- Hide if its a hidden section unless its the current path (users go direct to the url) -->
              
                <li>
                  <a class="main-section" href="/libs">Libraries</a>

                  <!-- TOC for single pages -->
                  
                    <ul class="unstyled nav nav--stacked epsilon soft--left toc"></ul>
                  

                  <!-- Sub sections -->
                  <ul class="unstyled nav nav--stacked epsilon soft--left collapsible is-collapsed">
                    

                    <!-- Add links to auto generated docs -->
                    
                    
                  </ul>
                </li>
              
            
          </ul>
        
      
    </div>
  </div>
</nav>


    <div id="content" class="content soft-double max-width--reading">
      <h1 id="personalization-developer-s-guide">Personalization Developer&#39;s Guide</h1>
<p><a href="http://www.optimizely.com/personalization">Optimizely Personalization</a> extends the Optimizely developer platform with new capabilities like behavioral targeting, audience discovery, and customer profiles. It also introduces a new code editor for custom JavaScript and CSS with important differences in how code is written and executed. The sections below describe these changes and explain how you can use a new set of JavaScript APIs for instrumenting behavior and developing experiences.</p>
<div class="attention attention--warning push--bottom"><b>Note:</b> The documentation below only applies to <a href="http://www.optimizely.com/personalization" target="_blank">Optimizely Personalization</a>. In the future, many of these APIs will also be available for use in Optimizely Testing.</div>

<h2 id="implementation">Implementation</h2>
<p>The first step to getting started with Optimizely Personalization is tracking the key pages, events, and tags on your site. See <a href="https://help.optimizely.com/hc/en-us/articles/210306928">The Six Core Concepts of Optimizely Personalization</a> for a high-level introduction to how these pieces work together. While much of this implementation is possible in the visual editor, we also provide a set of JavaScript APIs for defining pages, tracking events, and adding tags on each for full flexibility.</p>
<p>These APIs are similar to the <a href="/javascript/reference/index.html#track-event">tracking calls in Optimizely Testing</a>, but they use a new format for pushing data. To call these new APIs, you call <code>optimizely.push</code> with an object containing a <code>type</code> property and additional parameters. See the sections below for detailed examples.</p>
<p>Some legacy API calls like <code>trackEvent</code> will automatically trigger a new API call in this format. You don&#39;t need to reimplement event tracking if you&#39;ve already set it up, but you can use the new API format to track additional tags for behavioral targeting (see below).</p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Legacy format
window.optimizely.push([&#39;trackEvent&#39;, &#39;watchedVideo&#39;]);

// New format
window.optimizely.push({
  type: &quot;event&quot;,
  eventName: &quot;watchedVideo&quot;,
  tags: { // Additional metadata for targeting (optional)
    title: &quot;Funny Cats&quot;,
    duration: 30,
  }
});
</code></pre>
<h3 id="events">Events</h3>
<p>The <code>event</code> method captures visitor behavior and additional data. You can track clicks and pageviews in Optimizely
without code, but this API call supports tracking other behaviors like watching a video. These events can be used for measuring the results of a campaign, or for defining an audience based on behavior. <a href="https://help.optimizely.com/Get_Started/Six_core_concepts_of_Optimizely_Personalization#events">Learn more about events.</a></p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;event&quot;</li>
<li><code>eventName</code> (string): The &quot;API name&quot; for an event created in Optimizely, e.g. <code>add_to_cart</code></li>
<li><code>tags</code> (object): A single-level JSON object with metadata about an event, e.g. the product being purchased.<ul>
<li><code>revenue</code> (integer): A special tag that denotes a revenue-generating event. Revenue should be an integer equal to 100 times the value. For example, a purchase of $79.99 or €79.99 would be <code>7999</code>. Revenue should only be attached to the final purchase to prevent double-counting, and if you&#39;ve already tracked events using the legacy <code>trackEvent</code> method you should not re-instrument it again.</li>
</ul>
</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Basic tracking
window.optimizely.push({
  type: &quot;event&quot;,
  eventName: &quot;watchedVideo&quot;
});

// Tracking revenue
window.optimizely.push({
  type: &quot;event&quot;,
  eventName: &quot;purchase&quot;,
  tags: {
    revenue: 5000,
  }
});

// Additional metadata
window.optimizely.push({
  type: &quot;event&quot;,
  eventName: &quot;purchase&quot;,
  tags: {
    revenue: 10000,
    quantity: 2,
    category: &quot;Shoes&quot;,
    subcategory: &quot;Sneakers&quot;,
  }
});
</code></pre>
<h3 id="pages">Pages</h3>
<p>The <code>page</code> method tracks the visitor&#39;s current context on a website. This context is used for both analytics (&quot;track the number of views to the checkout page&quot;) and targeting (&quot;run this experiment on the checkout page&quot;). <a href="https://help.optimizely.com/hc/en-us/articles/210306928#pages">Learn more about pages.</a></p>
<p>Specifically, pushing a page has two effects:</p>
<ul>
<li>Optimizely will track a pageview event for this page, incrementing the count of views to that page in analytics and recording the event in the user&#39;s behavioral profile</li>
<li>Any campaigns targeted to this page will be activated</li>
</ul>
<p>Pages can be created visually in Optimizely with URL targeting, but this API call allows you to manually activate a page. This allows full flexibility for sites with dynamic content or challenging URL patterns.</p>
<p>Page information is reset whenever the browser reloads.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;page&quot;</li>
<li><code>pageName</code> (string): The &quot;API name&quot; for a page created in Optimizely, e.g. <code>product_detail</code>. Choose the &quot;manual activation&quot; option in page creation to see or change this name.</li>
<li><code>tags</code> (object): A single-level JSON object with metadata about the content on the page, e.g. the product being purchased.</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">window.optimizely = window.optimizely || [];

// Basic page tracking
window.optimizely.push({
  type: &quot;page&quot;,
  pageName: &quot;checkout_stage_1&quot;
});

// Page tracking with tags
window.optimizely.push({
  type: &quot;page&quot;,
  pageName: &quot;product_detail&quot;,
  tags: {
    category: &quot;Kitchen&quot;,
    subcategory: &quot;Blenders&quot;,
    price: 64999,
    sku: &quot;113757&quot;
  }
});
</code></pre>
<h3 id="tags">Tags</h3>
<p>Tags are contextual metadata about pages and events. They identify what a user is looking at, clicking on, or interacting with. For example, you can use tags to describe a product being purchased, an article being read, or a flight being booked. <a href="https://help.optimizely.com/hc/en-us/articles/210306928#tags">Learn more about tags.</a></p>
<p>There are three ways to capture this context:</p>
<ul>
<li>Directly on an <a href="#events">event</a>, using the <code>tags</code> property.</li>
<li>Directly on a <a href="#pages">page</a>, using the <code>tags</code> property. These tags will be sent along with any event that happens on that page.</li>
<li>Finally, you can use this <code>tags</code> method directly to add context without activating a page and tracking a pageview. This is equivalent to the previous option, but it can be used when pages are already being activated using URL targeting.</li>
</ul>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;tags&quot;</li>
<li><code>tags</code> (object): A single-level JSON object with metadata about an event, e.g. the product being purchased.</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Tracking the current product
window.optimizely.push({
  type: &quot;tags&quot;,
  tags: {
    category: &quot;Kitchen&quot;,
    subcategory: &quot;Blenders&quot;,
    price: 64999,
    sku: &quot;113757&quot;
  }
});
</code></pre>
<h3 id="users">Users</h3>
<p>The <code>user</code> method captures attributes of a user and stores them in a profile that persists across sessions and syncs across devices. These attributes are persisted in the browser&#39;s local storage and can be used for targeting and analysis.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;user&quot;</li>
<li><code>attributes</code> (object): Metadata about a user, e.g. their home state. Attributes can be used for discovering and targeting audiences.</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">window.optimizely = window.optimizely || [];

// Attach extra information to an anonymous visitor
window.optimizely.push({
  type: &quot;user&quot;,
  attributes: {
    frequentFlyerStatus: &quot;Gold&quot;,
    frequentFlyerMiles: 25600
  }
});

// To remove an attribute value, set it to null
window.optimizely.push({
  type: &quot;user&quot;,
  attributes: {
    frequentFlyerStatus: null
  }
});
</code></pre>
<h2 id="developing-experiences">Developing experiences</h2>
<p>Optimizely Personalization allows you to build experiences using a visual editor or make more sophisticated changes by writing your own custom code. To give you full control over the execution of that code, we&#39;ve changed the timing of when code is applied and added new utility functions for adjusting that timing.</p>
<h3 id="timing">Timing</h3>
<p>The execution model for JavaScript has been revamped in Optimizely Personalization, so developers familiar with our Testing product should be careful copying over existing code. There are two key differences:</p>
<p><em>Custom code and visual changes are separated</em>. When you make a change in the visual editor, you won&#39;t see the corresponding jQuery in the code box. Instead, the change is stored in a JSON data structure and applied at runtime. Each visual change is applied when the selector it applies to is ready.</p>
<p><em>Custom code runs immediately</em>. Because visual and code changes are mixed together, Optimizely Testing polls for each line separately and tries to run it when elements were ready. In Personalization, we&#39;ve removed this behavior so that your code runs exactly as written, <em>often before the DOM is ready</em>.</p>
<p>Please note this means that some code that works in Optimizely Testing may <em>not</em> work in Personalization. For example, the following code would have no effect if the Optimizely snippet is in the head tag because the body element doesn&#39;t exist at the time when the code runs:</p>
<pre><code class="lang-js">$(&quot;body&quot;).css(&quot;background-color&quot;, &quot;red&quot;);
</code></pre>
<p>To delay running the code until the whole page is loaded, you can use jQuery&#39;s <code>document.ready</code> function or one of the <a href="#utilities">utility functions</a> below:</p>
<pre><code class="lang-js">// Change the background when the DOM is ready (may cause flashing)
$(document).ready(function() {
  $(&quot;body&quot;).css(&quot;background-color&quot;, &quot;red&quot;);
});

// Change the background as soon as the body element loads (no flash)
var utils = window.optimizely.get(&#39;utils&#39;);
utils.waitForElement(&#39;body&#39;).then(function(){
   $(&quot;body&quot;).css(&quot;background-color&quot;, &quot;red&quot;);
});
</code></pre>
<p>You could also use the CSS option under Custom Code to make the same change without worrying about timing. CSS changes are applied by appending a <code>style</code> tag to the end of the <code>body</code> tag.</p>
<pre><code class="lang-css">body {
  background-color: red;
}
</code></pre>
<p>Finally, there are several different places where you can write custom code. Changes are applied synchronously in the following order:</p>
<ol>
<li>Project JS <a href="https://help.optimizely.com/hc/en-us/articles/202480860-Project-Settings-JavaScript-jQuery#project_javascript">(learn more)</a></li>
<li>Campaign JS</li>
<li>Campaign CSS</li>
<li>Experience JS</li>
<li>Experience CSS</li>
<li>Visual editor changes</li>
</ol>
<p><em>Note:</em> Personalization campaigns and Testing experiments can execute in parallel. Be careful assuming any dependencies between them or optimizing the same element in multiple campaigns/experiments.</p>
<h3 id="utilities">Utilities</h3>
<p>In addition to updating the <code>push</code> API, Optimizely Personalization also exposes a new function, <code>window.optimizely.get()</code>. This function allows you to access several useful properties and utilities within the context of custom code. Please note that unlike <code>push</code>, <code>get</code> may only be used after the Optimizely snippet has loaded. While this will always be the case within custom code, it should be considered when using <code>get</code> within external scripts.</p>
<p>For example, if you have <a href="https://help.optimizely.com/hc/en-us/articles/202480860-Project-Settings-JavaScript-jQuery#jS">jQuery bundled</a> in the Optimizely snippet, you can access it directly by getting <code>jquery</code>:</p>
<pre><code class="lang-js">var $ = window.optimizely.get(&#39;jquery&#39;);
</code></pre>
<p>If no jQuery is bundled into the client, the default return value is <code>window.jQuery</code>.</p>
<pre><code class="lang-js">var utils = window.optimizely.get(&#39;utils&#39;);
</code></pre>
<h4 id="waitForElement" class="subLink">waitForElement</h4>

<p>This utility returns a <code>Promise</code> that will be resolved as soon as an element appears in the DOM matching the supplied selector.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>selector</code> (string): CSS selector, ex. &quot;.product-item&quot;</li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>An <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">ES6-style Promise</a> that will be resolved with the matching element.</p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the utils library
var utils = window.optimizely.get(&#39;utils&#39;);

// Wait for the footer element to appear in the DOM, then change the color
utils.waitForElement(&#39;.footer&#39;).then(function(footerElement){
  footerElement.style.color = &#39;black&#39;;
});
</code></pre>
<h4 id="observeSelector" class="subLink">observeSelector</h4>

<p>This utility provides a subset of the functionality of a <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObserver</a>, allowing you to run a function whenever a DOM selector changes. Given a CSS selector and a callback, this function will invoke the supplied callback whenever a new element appears in the DOM matching the supplied selector.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>selector</code> (string): CSS selector, ex &quot;.product-item&quot;</li>
<li><code>callback</code> (function): A function that accepts an <code>HTMLDomElement</code> as its first parameter</li>
<li><code>options</code> (object):<ul>
<li><code>timeout</code> (string|null): Number of milliseconds to try before canceling. If null, continues indefinitely</li>
<li><code>once</code> (boolean): If true, the callback will be invoked for the first match only</li>
<li><code>onTimeout</code> (function): Function to execute on timeout</li>
</ul>
</li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>A function that can be executed to cancel observation</p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the utils library
var utils = window.optimizely.get(&#39;utils&#39;);

// Modify elements displaying product prices whenever they appear on the page
var cancelProductPriceObserver = utils.observeSelector(&#39;.productPrice&#39;, function(priceElement) {
  priceElement.style.fontSize = &#39;30px&#39;;
  priceElement.style.color = &#39;red&#39;;
});
</code></pre>
<h4 id="poll" class="subLink">poll</h4>

<p>This is a convenience wrapper for <code>setInterval</code>.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>callback</code> (function): Function to be executed on the interval specified by <code>delay</code></li>
<li><code>delay</code> (number): Milliseconds to wait in between each callback invocation</li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>A function that can be executed to cancel polling.</p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the utils library
var utils = window.optimizely.get(&#39;utils&#39;);

// Wait until the element we want to modify is in the DOM
utils.waitForElement(&#39;#pre-header-shipping-cont&#39;).then(function(headerElement) {

  // 10 minutes in ms
  var timeRemaining = 60000;

  // Create a reservation countdown timer that expires after 10 minutes
  // We want to instill some urgency in our customers so that they buy buy buy
  var cancelPolling = utils.poll(function() {
    timeRemaining = timeRemaining - 1000;

    // Update message based on how much time is remaining
    if (timeRemaining &gt; 0) {
      var date = new Date(timeRemaining);
      headerElement.innerHTML = &#39;You have &#39; + date.getMinutes() + &#39;:&#39; + date.getSeconds() + &#39; before your reservation expires.&#39;;
    } else {
      headerElement.innerHTML = &#39;Your reservation has expired&#39;;
      cancelPolling();
    }
  }, 1000);
});
</code></pre>
<h4 id="waitUntil" class="subLink">waitUntil</h4>

<p>This utility accepts a function that returns a boolean value and returns a <code>Promise</code> that resolves when the supplied function returns <code>true</code>.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>conditionFunction</code> (function): A function that will be executed periodically and returns a boolean value</li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>An <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">ES6-style Promise</a></p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the utils library
var utils = window.optimizely.get(&#39;utils&#39;);

// We have infinite scroll enabled on the site. Wait until more than 200 products have been shown
// to prompt the user to try out our filter by color feature
utils.waitUntil(function() {
  var productsShownOnThePage = document.querySelectorAll(&#39;.product-listing&#39;);
  return productsShownOnThePage &amp;&amp; productsShownOnThePage.length &gt; 200;
}).then(function() {
  alert(&#39;Not finding what you\&#39;re looking for? Try narrowing down your search using our new filter by color feature&#39;);
});
</code></pre>
<h3 id="listeners">Listeners</h3>
<p>As Optimizely runs on your site, you can hook into the snippet&#39;s execution and run your own code at different points by using the <code>addListener</code> API. Looking for other listeners? Contact us at <a href="mailto:developers@optimizely.com">developers@optimizely.com</a>.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;addListener&quot;</li>
<li><code>filter</code> (object): The events to listen for<ul>
<li><code>type</code> (string)</li>
<li><code>name</code> (string)</li>
</ul>
</li>
<li><code>handler</code> (function): A callback to run when an event fires. The function takes a single <code>data</code> object that varies based on the event.</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">
window.optimizely = window.optimizely || [];

window.optimizely.push({
  type: &#39;addListener&#39;,
  filter: {
    type: &#39;lifecycle&#39;,
    name: &#39;viewActivated&#39;,
  },
  handler: function(data) {
    console.log(&#39;Page&#39;, data.name, &#39;was activated.&#39;);
  },
});
</code></pre>
<h4 id="layerDecided" class="subLink">Campaign Decision</h4>

<p>This listener fires whenever a decision is made for a campaign. This means that Optimizely has chosen an audience/experience to display.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;lifecycle&quot;</li>
<li><code>name</code>: &quot;layerDecided&quot;</li>
</ul>
<h5 id="-callback-parameters-"><em>Callback Parameters</em></h5>
<ul>
<li><code>data</code>: (object)<ul>
<li><code>layer</code>: (object) Details about the campaign</li>
<li><code>decisionTicket</code>: (object) Metadata used to make the decision</li>
<li><code>decision</code>: (object) The audience and variation ID that were decided</li>
</ul>
</li>
</ul>
<h4 id="viewActivated" class="subLink">Page Activation</h4>

<p>This listener fires whenever a page is activated, either due to URL targeting or manual activation.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>type</code>: &quot;lifecycle&quot;</li>
<li><code>name</code>: &quot;viewActivated&quot;</li>
</ul>
<h5 id="-callback-parameters-"><em>Callback Parameters</em></h5>
<ul>
<li><code>data</code>: (object)<ul>
<li><code>id</code> (integer)</li>
<li><code>name</code> (string): The user-friendly name, like &quot;Homepage&quot;</li>
<li><code>apiName</code> (string): The API name for the page, used for manual activation</li>
<li><code>category</code> (string): The category, like &quot;homepage&quot;</li>
</ul>
</li>
</ul>
<h3 id="behavior">Behavior</h3>
<h4 id="query" class="subLink">query</h4>

<p>This API function runs a behavioral query over the <a href="https://help.optimizely.com/Get_Started/Six_core_concepts_of_Optimizely_Personalization#events">events</a> that have taken place on this device.</p>
<p>Currently, the API only considers events that took place before the most recent activation of the Optimizely snippet.  You must reload the page if you want to query over events that took place on the current page load.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>query</code> (object): A <a href="/behavior/#query-objects">behavioral query object</a></li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>Depending on which clauses are included in the specified query object, this API will return one of the following types of values:</p>
<ul>
<li>A simple value like a number, a boolean, a string, or any other value that may have been specified in a tag.  May be <code>undefined</code> if the specified tag was not set on the filtered event.</li>
<li>A list containing multiple simple values.</li>
<li>An <a href="/behavior/#event-objects">event object</a>.</li>
<li>A list containing multiple events.</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">var behavior = window.optimizely.get(&#39;behavior&#39;);

// Return a list of page names, sorted by viewing frequency.
behavior.query({
  &quot;version&quot;: &quot;0.2&quot;,
  &quot;filter&quot;: {
    &quot;field&quot;: [&quot;type&quot;],
    &quot;value&quot;: &quot;pageview&quot;
  },
  &quot;pick&quot;: {
    &quot;field&quot;: [&quot;name&quot;]
  },
  &quot;sort&quot;: [
    {
      &quot;field&quot;: [&quot;frequency&quot;],
      &quot;direction&quot;: &quot;descending&quot;
    }
  ]
});
</code></pre>
<h3 id="customer-profiles">Customer Profiles</h3>
<h4 id="getAttributeValue" class="subLink">getAttributeValue</h4>

<p>This API function returns the current customer&#39;s value for a <a href="https://help.optimizely.com/hc/en-us/articles/216497887">content-enabled</a> profile attribute.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>datasourceId</code> (number): Required</li>
<li><code>attributeId</code> (number): Required if <code>attributeName</code> is not provided</li>
<li><code>attributeName</code> (string): Required if <code>attributeId</code> is not provided.  Does not work if descriptive names are <a href="https://help.optimizely.com/hc/en-us/articles/208997878-Project-Settings-Privacy#masking_descriptive_names">masked</a> in the Optimizely client</li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>The uploaded attribute value, or <code>undefined</code> if any of the following are true:</p>
<ul>
<li>A customer profile still needs to be <a href="https://help.optimizely.com/hc/en-us/articles/216307487#upload">uploaded</a> for the current user.</li>
<li>A profile has been uploaded, but it does not include the desired attribute.</li>
<li>The Optimizely client is waiting for fresh data from the DCP service.</li>
</ul>
<h5 id="-throws-"><em>Throws</em></h5>
<p>If any of the following are true:</p>
<ul>
<li>The specified attribute does not exist</li>
<li>The attribute is not content-enabled</li>
<li>The attribute is specified by name even though names are <a href="https://help.optimizely.com/hc/en-us/articles/208997878-Project-Settings-Privacy#masking_descriptive_names">masked</a> in the Optimizely client</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the dcp library
var dcp = window.optimizely.get(&#39;dcp&#39;);

// Specify a content-enabled attribute by ID.
dcp.getAttributeValue({datasourceId: 123, attributeId: 456});

// Specify a content-enabled attribute by name.
dcp.getAttributeValue({datasourceId: 123, attributeName: &#39;Preferred Locale&#39;});
</code></pre>
<h4 id="waitForAttributeValue" class="subLink">waitForAttributeValue</h4>

<p>This API function returns a <code>Promise</code> that will be resolved as soon as Optimizely receives the current customer&#39;s value for a <a href="https://help.optimizely.com/hc/en-us/articles/216497887">content-enabled</a> profile attribute.</p>
<h5 id="-parameters-"><em>Parameters</em></h5>
<ul>
<li><code>datasourceId</code> (number): Required</li>
<li><code>attributeId</code> (number): Required if <code>attributeName</code> is not provided</li>
<li><code>attributeName</code> (string): Required if <code>attributeId</code> is not provided.  Does not work if descriptive names are <a href="https://help.optimizely.com/hc/en-us/articles/208997878-Project-Settings-Privacy#masking_descriptive_names">masked</a> in the Optimizely client</li>
</ul>
<h5 id="-returns-"><em>Returns</em></h5>
<p>An <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">ES6-style Promise</a> that
will be resolved with the uploaded attribute value, or with <code>undefined</code> if any of the following are true:</p>
<ul>
<li>A customer profile still needs to be <a href="https://help.optimizely.com/hc/en-us/articles/216307487#upload">uploaded</a> for the current user.</li>
<li>A profile has been uploaded, but it does not include the desired attribute.</li>
</ul>
<p>If your campaign does not <a href="https://help.optimizely.com/hc/en-us/articles/216497887#campaign">target a DCP Audience</a>,
then it is possible that profile data will not be fetched and the Promise will not be resolved.</p>
<h5 id="-throws-"><em>Throws</em></h5>
<p>If any of the following are true:</p>
<ul>
<li>The specified attribute does not exist</li>
<li>The attribute is not content-enabled</li>
<li>The attribute is specified by name even though names are <a href="https://help.optimizely.com/hc/en-us/articles/208997878-Project-Settings-Privacy#masking_descriptive_names">masked</a> in the Optimizely client</li>
</ul>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the dcp library
var dcp = window.optimizely.get(&#39;dcp&#39;);

// Specify a content-enabled attribute by ID.
dcp.waitForAttributeValue({datasourceId: 123, attributeId: 456}).then(
  function (attributeValue) {
  }
);

// Specify a content-enabled attribute by name.
dcp.waitForAttributeValue({datasourceId: 123, attributeName: &#39;Preferred Locale&#39;}).then(
  function (attributeValue) {
  }
);
</code></pre>
<h2 id="reading-data-and-state">Reading data and state</h2>
<p><code>optimizely.get</code> can also be used to get read-only information about the current visitor, sessions, and running campaigns.</p>
<h3 id="data">Data</h3>
<p>Returns an object exposing static data fields.</p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the data object
var staticData = window.optimizely.get(&#39;data&#39;);
</code></pre>
<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li><code>Object</code>:<ul>
<li><code>accountId</code> (string)</li>
<li><code>projectId</code> (string)</li>
<li><code>revision</code> (string)</li>
<li><code>dcpServiceId</code> (string|null)</li>
<li><code>audiences</code> (object) Object mapping Audience ID to:<ul>
<li><code>id</code> (string): The audience id</li>
<li><code>name</code> (string)</li>
<li><code>conditions</code> (array): Conditions the visitor must have to be in the audience</li>
</ul>
</li>
<li><code>campaigns</code> (object) Object mapping Campaign ID to:<ul>
<li><code>id</code> (string): The campaign id</li>
<li><code>name</code> (string)</li>
<li><code>policy</code> (string): ordered (personalization) or random (A/B test)</li>
<li><code>holdback</code> (BasisPoints): 0 - 100</li>
<li><code>weightDistributions</code> (object|null): Traffic allocation among the experiments in the campaign</li>
<li><code>activation</code> (object|null)</li>
<li><code>changes</code> (array|null): An array of changes</li>
<li><code>commitId</code> (string|null)</li>
<li><code>experiments</code> (array): An array of the experiments in the campaign</li>
<li><code>integrationSettings</code> (object)</li>
<li><code>viewIds</code> (array): An array of view ids (strings) associated with the campaign</li>
</ul>
</li>
<li><code>events</code> (object) Object mapping Event ID to:<ul>
<li><code>id</code> (string): The event id</li>
<li><code>name</code> (string|null): The event name</li>
<li><code>apiName</code> (string)</li>
<li><code>category</code> (string): added to cart, saved, shared, searched, purchased, converted, signed up, subscribed, other</li>
<li><code>eventType</code> (string): click, custom, engagement, or pageview</li>
<li><code>eventFilter</code> (object|null): Filter type of string or target selector</li>
<li><code>viewId</code> (string|null)</li>
</ul>
</li>
<li><code>pages</code> (object) Object mapping Page ID to:<ul>
<li><code>id</code> (string): The page id</li>
<li><code>name</code> (string|null): The page name</li>
<li><code>apiName</code> (string)</li>
<li><code>category</code> (string): article, cart, category, checkout, home, landing page, pricing, product detail, search results, other</li>
<li><code>staticConditions</code> (array)</li>
<li><code>tags</code> (array)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="session">Session</h3>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the session object
var sessionData = window.optimizely.get(&#39;session&#39;);
</code></pre>
<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li><code>Object</code>:<ul>
<li><code>lastSessionTimestamp</code> (number|0)</li>
<li><code>sessionId</code> (string|null)</li>
</ul>
</li>
</ul>
<h3 id="visitor-id">Visitor ID</h3>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the visitor ID data object
var visitorIdData = window.optimizely.get(&#39;visitor_id&#39;);
</code></pre>
<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li><code>Object</code>:<ul>
<li><code>randomId</code> (string|null): If no UUID is available, Optimizely will generate a random visitor id</li>
<li><code>UUID</code> (string|null): Your unique identifier for a user (universally unique identifier)</li>
</ul>
</li>
</ul>
<h3 id="visitor">Visitor</h3>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Retrieve the visitor profile
var visitorProfile = window.optimizely.get(&#39;visitor&#39;);
$(&quot;#username&quot;).text(visitorProfile.custom.userName);
</code></pre>
<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li><code>Object</code>:<ul>
<li><code>IP</code> (string): The visitor&#39;s IP address</li>
<li><code>browserId</code> (string)</li>
<li><code>browserVersion</code> (string)</li>
<li><code>campaign</code> (string|null): The campaign the visitor is in</li>
<li><code>cookies</code> (object): The visitor&#39;s optimizely cookies</li>
<li><code>currentTimestamp</code> (number)</li>
<li><code>dcpData</code> (object): Indicates personalized content delivered via named or unnamed DCP attributes</li>
<li><code>defaultBehavior</code> (object): Includes default values for a variety of properties, such as average events per session, most viewed page, average revenue per order last 60 days, etc.</li>
<li><code>device</code> (string): The visitor&#39;s device (e.g., desktop, laptop, etc.)</li>
<li><code>events</code> (array)</li>
<li><code>first_session</code> (boolean): True if it is the visitor&#39;s first session</li>
<li><code>language</code> (string)</li>
<li><code>lists</code> (object)</li>
<li><code>location</code> (object): Includes fields for city, continent, country, and region</li>
<li><code>queryParams</code> (array)</li>
<li><code>referrer</code> (string|null)</li>
<li><code>source_type</code> (string|null)</li>
<li><code>visitorId</code> (string|null): The visitor&#39;s randomly generated Optimizely ID</li>
</ul>
</li>
</ul>
<h3 id="state">State</h3>
<p>Returns a module exposing several functions to access information about the current visitor&#39;s state</p>
<h5 id="-usage-"><em>Usage</em></h5>
<pre><code class="lang-js">// Access the state module
var stateModule = window.optimizely.get(&#39;state&#39;);

// Use the state module to access the campaign states
var campaignStates = stateModule.getCampaignStates();
</code></pre>
<h4 id="getCampaignStates" class="subLink">getCampaignStates()</h4>

<p>Returns a map of campaign states, indexed by campaign id.</p>
<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li><code>Object</code> Object mapping Campaign ID to:<ul>
<li><code>id</code> (string)</li>
<li><code>campaignName</code> (string)</li>
<li><code>audiences</code> (array)</li>
<li><code>experiment</code> (object|null)</li>
<li><code>variation</code> (object|null)</li>
<li><code>reason</code> (string|null): Reason why experiment or variation id is null</li>
</ul>
</li>
</ul>
<h4 id="getPageStates" class="subLink">getPageStates()</h4>

<p>Returns a map of page states, indexed by page id.</p>
<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li><code>Object</code> Object mapping Page ID to:<ul>
<li><code>id</code> (string)</li>
<li><code>apiName</code> (string)</li>
<li><code>category</code> (string): article, cart, category, checkout, home, landing page, pricing, product detail, search results, other</li>
<li><code>isActive</code> (boolean)</li>
<li><code>metadata</code> (object)</li>
<li><code>name</code> (string)</li>
<li><code>staticConditions</code> (array)</li>
<li><code>tags</code> (array)</li>
</ul>
</li>
</ul>
<h4 id="getActivationId" class="subLink">getActivationId()</h4>

<h5 id="-returns-"><em>Returns</em></h5>
<ul>
<li>string: current activation ID</li>
</ul>
<h2 id="debugging">Debugging</h2>
<h3 id="logging">Logging</h3>
<p>You can tell Optimizely to output its log to the browser&#39;s console log by using the query parameter <code>optimizely_log={level}</code>. For example, you can follow the high-level execution by adding <code>?optimizely_log=info</code>. The following levels are supported, and the default is off:</p>
<ul>
<li><strong>OFF</strong>: No logging</li>
<li><strong>ERROR</strong>: Errors only</li>
<li><strong>WARN</strong>: Warnings and errors</li>
<li><strong>INFO</strong>: High-level information on campaigns, audiences, and event tracking</li>
<li><strong>DEBUG</strong>: Detailed logging for debugging purposes</li>
<li><strong>ALL</strong>: All logs</li>
</ul>
<h3 id="campaign-activation">Campaign Activation</h3>
<p>You can use the <a href="#logging">logging output</a> to see which campaigns are activating for a given a visitor, and which experience they will see.</p>
<p>First, enable logging by adding <code>?optimizely_log=info</code> to a URL on your site. Then, open your browser&#39;s console to see the logging output. To make the log more readable, it may help to filter within the console log to &quot;Optly /&quot; so that other messages are hidden.</p>
<p><img src="/assets/img/js/init.png" alt=""></p>
<p>The first few lines cover the initialization of the Optimizely client, including data like the active campaigns, events, and pages. You can use this section to confirm that the right data is being compiled into the snippet. Some of the terminology is slightly different from the user interface:</p>
<ul>
<li>Experiences within a campaign are listed as <code>experiments</code> within a layer, each of which has a single <code>variation</code> with a set of <code>actions</code>.</li>
<li><code>actions</code> are the set of changes that apply for a specific experience on a particular page</li>
</ul>
<p>To debug a specific campaign, you can search within the console (Cmd-F) for that campaign&#39;s ID. You can find the ID in the URL of the Optimizely interface. A campaign with the URL <code>https://app.optimizely.com/p13n/3563611614/layers/3558430129</code> has the ID <code>3558430129</code>. Searching for this ID will show all log events related to that campaign. For example:</p>
<p><img src="/assets/img/js/decision-no.png" alt=""></p>
<p>In this example, the output is telling us that the visitor did not match any of the audiences in the campaign. Therefore, they weren&#39;t eligible for any experiences and no changes were applied.</p>
<p>Now let&#39;s add the visitor to a campaign audience to apply a change:</p>
<p><img src="/assets/img/js/full-screen.png" alt=""></p>
<p>In this example, the output tells us that the visitor was in the Campaign &quot;Homepage Offers&quot;. Let&#39;s take a closer look at some of the entries in the log:</p>
<p><img src="/assets/img/js/recording-decision.png" alt=""></p>
<p>If we click on the Objects in the log to inspect them, we can see some of the details about the &quot;decision ticket&quot; (the information Optimizely uses in order to make a decision of which experience to show, if any) on the left of the arrow &quot;-&gt;&quot; and the &quot;decision&quot; (the selected experiment/variation, if any, and whether the visitor is in the layer holdback) on the right hand side. In particular note the &quot;audienceIds&quot; property of the decision ticket which shows the IDs of the audiences the visitor was in at the time of the decision (in this case &quot;4055203664&quot;).</p>
<p><img src="/assets/img/js/tracking-decision.png" alt=""></p>
<p>Next we can see that Optimizely created a log event to track the decision. By inspecting the log event we can see that it has properties &quot;decisionTicket&quot; and &quot;decision&quot; corresponding to the objects we inspected above, as well as information about the client version, a guid and timestamp to track the event in Optimizely&#39;s logs, and others (event properties subject to change).</p>
<p><img src="/assets/img/js/action-executing.png" alt=""></p>
<p>In addition to recording and tracking the decision, Optimizely applies the actions (changes) corresponding to the current view. By clicking on the Object to inspect, we can see that the action is associated with the current campaign (layerId) and selected experiment/variation (from the decision), and consists of a &quot;changeSet&quot; (list of changes), each of which describes a change to apply. The change detail above shows that the first change in the set is an &quot;attribute&quot; change which changes the &quot;html&quot; (innerHTML) of the &quot;.hero__title&quot; element to the string &quot;Stylish new looks for p13n-ers&quot;. If there is an error applying this change, it will be logged here as well.</p>
<h3 id="events-and-tags">Events and Tags</h3>
<p>To debug event tracking and visual tags, you can use the network tab to observe requests to Optimizely&#39;s log endpoint. For example, in Google Chrome, you can open the Developer Tools and then reload the page. When you click on the Network tab, you&#39;ll see all the network requests on that page. You can filter these requests to show only those made by Optimizely for tracking purposes by filtering to <code>p13nlog</code>. When you trigger an event, e.g. by clicking a button, you&#39;ll see it fire here. For example:</p>
<p><img src="/assets/img/js/event.png" alt=""></p>
<p>In this example, we&#39;ve triggered the Share button on the Product Detail Page. The <code>eventName</code> shows the API name of the event, and the <code>type</code> corresponds to the category in the Optimizely interface. For pages, <code>eventType = &#39;view-activated&#39;</code> and the <code>eventName</code> will be the ID of the page.</p>
<p>The <code>eventFeatures</code> show tags that were captured on the page. In this case, we can see tags picking up the product&#39;s category, subcategory, title, and price. <code>eventMetrics</code> show tags that are used as metrics on the results page, like revenue for a custom event. Finally, the <code>layerStates</code> show which campaigns the event will be attributed to.</p>

    </div>
  </main>

  <footer class="footer cf soft--ends soft-double--sides">
    <div class="float--left">
      <a href="https://www.optimizely.com">
        <img class="display--inline-block vertical-align--bottom" src="/assets/img/optimizely_logo_footer.svg">
      </a>
      <span class="soft--left">&copy; 2016 Optimizely</span>
      <a class="soft--left is-hidden-on-mobile" href="https://www.optimizely.com/terms/">Terms of Service</a>
      <a class="soft--left" href="https://www.optimizely.com/privacy/">Privacy Policy</a>
    </div>
    <div class="float--right is-hidden-on-mobile" style="margin-top: 2px;">
       <a class="soft--left" href="https://www.optimizely.com/">Optimizely.com</a>
       <a class="soft--left" href="https://blog.optimizely.com/">Blog</a>
       <a class="soft--left" href="https://help.optimizely.com/">Help</a>
       <a class="soft--left" href="https://community.optimizely.com/">Community</a>
       <a class="soft--left" href="https://www.optimizely.com/jobs/">Jobs</a>
    </div>
  </footer>


    <!-- JQUERY -->
    <script src="//code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-13208639-14', 'optimizely.com');
      ga('send', 'pageview');
    </script>

    
  </body>
</html>

